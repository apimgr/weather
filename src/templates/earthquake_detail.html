{{template "head" .}}
{{template "navbar" .}}

{{$titleClass := "eq-detail-title--red"}}
{{if eq .Earthquake.Tsunami 1}}
    {{$titleClass = "eq-detail-title--cyan"}}
{{else if lt .Earthquake.Magnitude 2.0}}
    {{$titleClass = "eq-detail-title--green"}}
{{else if lt .Earthquake.Magnitude 4.0}}
    {{$titleClass = "eq-detail-title--yellow"}}
{{else if lt .Earthquake.Magnitude 5.0}}
    {{$titleClass = "eq-detail-title--orange"}}
{{end}}

{{$magnitudeClass := "eq-magnitude__badge--major"}}
{{if lt .Earthquake.Magnitude 2.0}}
    {{$magnitudeClass = "eq-magnitude__badge--minor"}}
{{else if lt .Earthquake.Magnitude 4.0}}
    {{$magnitudeClass = "eq-magnitude__badge--light"}}
{{else if lt .Earthquake.Magnitude 5.0}}
    {{$magnitudeClass = "eq-magnitude__badge--moderate"}}
{{else if lt .Earthquake.Magnitude 6.0}}
    {{$magnitudeClass = "eq-magnitude__badge--strong"}}
{{end}}

<div class="weather-container page-container earthquake-detail">
    <nav class="eq-detail-nav">
        <a href="/" class="eq-detail-nav__link eq-detail-nav__link--home">🏠 Home</a>
        <a href="/moon" class="eq-detail-nav__link eq-detail-nav__link--moon">🌙 Moon</a>
        <a href="/earthquake" class="eq-detail-nav__link eq-detail-nav__link--earthquake">🌍 Earthquakes</a>
    </nav>

    <a href="/earthquake" class="eq-detail-back-link">← Back to Earthquakes</a>

    <section class="eq-detail-card">
        <h1 class="eq-detail-title {{$titleClass}}">{{.Earthquake.Place}}</h1>

        <div class="eq-detail-summary">
            <div class="eq-magnitude">
                <span class="eq-magnitude__badge {{$magnitudeClass}}">{{printf "%.1f" .Earthquake.Magnitude}}</span>
                <span class="eq-magnitude__label">Magnitude</span>
            </div>

            {{if eq .Earthquake.Tsunami 1}}
            <div class="eq-tsunami-alert">🌊 Tsunami Warning</div>
            {{end}}
        </div>

        <div class="eq-detail-grid">
            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Time</div>
                <div class="eq-detail-attribute__value">{{.Earthquake.Time.Format "2006-01-02 15:04:05"}}</div>
                <div class="eq-detail-attribute__meta">{{.Earthquake.Time.Format "MST"}}</div>
            </div>

            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Location</div>
                <div class="eq-detail-attribute__value">{{.Earthquake.Latitude}}°, {{.Earthquake.Longitude}}°</div>
                <div class="eq-detail-attribute__meta">Latitude, Longitude</div>
            </div>

            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Depth</div>
                <div class="eq-detail-attribute__value">{{printf "%.1f" .Earthquake.Depth}} km</div>
                <div class="eq-detail-attribute__meta">Below surface</div>
            </div>

            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Status</div>
                <div class="eq-detail-attribute__value">{{.Earthquake.Status | upper}}</div>
                <div class="eq-detail-attribute__meta">Reviewed by USGS</div>
            </div>

            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Type</div>
                <div class="eq-detail-attribute__value">{{.Earthquake.MagnitudeType}} {{.Earthquake.Type | upper}}</div>
            </div>

            {{if .Earthquake.Felt}}
            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Reported Felt</div>
                <div class="eq-detail-attribute__value">{{.Earthquake.Felt}} people</div>
                <div class="eq-detail-attribute__meta">USGS Did You Feel It?</div>
            </div>
            {{end}}

            {{if .Earthquake.CDI}}
            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">CDI</div>
                <div class="eq-detail-attribute__value">{{printf "%.1f" .Earthquake.CDI}}</div>
                <div class="eq-detail-attribute__meta">Community Determined Intensity</div>
            </div>
            {{end}}

            {{if .Earthquake.MMI}}
            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">MMI</div>
                <div class="eq-detail-attribute__value">{{printf "%.1f" .Earthquake.MMI}}</div>
                <div class="eq-detail-attribute__meta">Modified Mercalli Intensity</div>
            </div>
            {{end}}

            {{if .Earthquake.Alert}}
            <div class="eq-detail-attribute">
                <div class="eq-detail-attribute__label">Alert Level</div>
                <div class="eq-detail-attribute__value">{{.Earthquake.Alert | upper}}</div>
            </div>
            {{end}}
        </div>

        <div id="map" class="map-container eq-detail-map"></div>
    </section>

    <section class="console-section">
        <h3 class="console-section__title text-green">📟 Console Command</h3>
        <div class="console-commands">
            <div class="command-item">
                <strong class="console-section__label">Detail:</strong>
                <div class="code-wrapper">
                    <code class="mobile-code">curl -q -LSs {{.HostInfo.FullHost}}/earthquake/detail/{{.Earthquake.ID}}</code>
                    <button class="copy-btn" onclick="copyCommand(this, 'curl -q -LSs {{.HostInfo.FullHost}}/earthquake/detail/{{.Earthquake.ID}}')">Copy</button>
                </div>
            </div>
        </div>
    </section>

    <div class="data-footer">
        <p class="data-footer__text">
            Data provided by <a href="https://earthquake.usgs.gov/" target="_blank" class="data-footer__link">USGS Earthquake Hazards Program</a><br>
            Updated frequently throughout the day
        </p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([{{.Earthquake.Latitude}}, {{.Earthquake.Longitude}}], 8);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors',
        maxZoom: 18
    }).addTo(map);

    const size = Math.max(10, {{.Earthquake.Magnitude}} * 5);
    const color = {{.Earthquake.Magnitude}} < 2 ? '#50fa7b' :
                 {{.Earthquake.Magnitude}} < 4 ? '#f1fa8c' :
                 {{.Earthquake.Magnitude}} < 5 ? '#ffb86c' :
                 {{.Earthquake.Magnitude}} < 6 ? '#ff5555' : '#bd93f9';

    const marker = L.circleMarker([{{.Earthquake.Latitude}}, {{.Earthquake.Longitude}}], {
        radius: size,
        fillColor: color,
        color: '#f8f8f2',
        weight: 3,
        opacity: 1,
        fillOpacity: 0.8
    }).addTo(map);

    const popupContent = `
        <div class="map-popup">
            <strong class="map-popup__title">M {{printf "%.1f" .Earthquake.Magnitude}}</strong>
            <div class="map-popup__place">{{.Earthquake.Place}}</div>
            <div class="map-popup__time">{{.Earthquake.Time.Format "2006-01-02 15:04:05"}}</div>
            <div class="map-popup__meta">Depth: {{printf "%.1f" .Earthquake.Depth}}km</div>
            {{if eq .Earthquake.Tsunami 1}}<div class="map-popup__warning">🌊 Tsunami Warning</div>{{end}}
        </div>
    `;
    marker.bindPopup(popupContent).openPopup();

    function copyCommand(button, text) {
        navigator.clipboard.writeText(text).then(() => {
            const originalText = button.textContent;
            button.textContent = '✓ Copied!';
            button.classList.add('copied');
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy:', err);
            button.textContent = '✗ Failed';
            setTimeout(() => {
                button.textContent = 'Copy';
            }, 2000);
        });
    }
</script>

{{template "footer" .}}
