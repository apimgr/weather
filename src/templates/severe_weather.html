<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - Weather</title>
    <link rel="stylesheet" href="/static/css/dracula.css">
    <script src="/static/js/app.js" defer></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö†Ô∏è</text></svg>">
</head>
<body>
    {{template "navbar" .}}

    <div class="container page-container">
        <div class="severe-weather-header">
            <h1 class="page-header">‚ö†Ô∏è Severe Weather Alerts</h1>
            <p class="page-subtitle">Real-time warnings for hurricanes, tornadoes, severe storms, winter weather, and floods</p>
        </div>

        {{if .HasLocation}}
        <div class="location-info">
            üìç Showing alerts for: <strong>{{.LocationName}}</strong>
        </div>
        {{end}}

        <div class="location-form">
            <input type="text" id="location-input" placeholder="Enter location or coordinates (e.g., Miami or 25.7617,-80.1918)" value="{{.LocationName}}">
            <select id="type-select" class="select-input">
                <option value="all" selected>All Types</option>
                <option value="hurricanes">üåÄ Hurricanes</option>
                <option value="tornadoes">üå™Ô∏è Tornadoes</option>
                <option value="storms">‚õàÔ∏è Severe Storms</option>
                <option value="winter">‚ùÑÔ∏è Winter Weather</option>
                <option value="floods">üåä Floods</option>
            </select>
            <select id="distance-select" class="select-input">
                <option value="25">25 miles</option>
                <option value="50" selected>50 miles</option>
                <option value="100">100 miles</option>
                <option value="250">250 miles</option>
                <option value="500">500 miles</option>
                <option value="0">All alerts</option>
            </select>
            <button onclick="updateLocation()">üîç Update</button>
        </div>

        <div class="alert-summary">
            <div class="summary-item">
                <div class="summary-count">{{.TotalStorms}}</div>
                <div class="summary-label">Hurricanes</div>
            </div>
            <div class="summary-item">
                <div class="summary-count">{{.TotalAlerts}}</div>
                <div class="summary-label">Active Alerts</div>
            </div>
        </div>

        {{if .Data}}
            {{/* Hurricanes Section */}}
            {{if .Data.Hurricanes}}
            <div class="alert-section">
                <div class="section-header">
                    <span class="section-icon">üåÄ</span>
                    <span class="section-title">Hurricanes & Tropical Storms</span>
                    <span class="section-count">{{len .Data.Hurricanes}}</span>
                </div>
                <div class="alerts-grid">
                    {{range .Data.Hurricanes}}
                    <div class="storm-card {{if ge .WindSpeed 157}}cat5{{else if ge .WindSpeed 130}}cat4{{else if ge .WindSpeed 111}}cat3{{else if ge .WindSpeed 96}}cat2{{else if ge .WindSpeed 74}}cat1{{else}}tropical{{end}}">
                        <div class="storm-name">{{.Name}}</div>
                        <div class="storm-category">{{.Intensity}}</div>
                        <div class="storm-details">
                            <div class="storm-detail">
                                <span class="detail-label">Wind Speed:</span>
                                <span class="detail-value">{{.WindSpeed}} mph</span>
                            </div>
                            <div class="storm-detail">
                                <span class="detail-label">Pressure:</span>
                                <span class="detail-value">{{.Pressure}} mb</span>
                            </div>
                            <div class="storm-detail">
                                <span class="detail-label">Location:</span>
                                <span class="detail-value">{{printf "%.2f" .Latitude}}, {{printf "%.2f" .Longitude}}</span>
                            </div>
                            {{if gt .DistanceMiles 0}}
                            <div class="storm-detail">
                                <span class="detail-label">Distance:</span>
                                <span class="detail-value">{{printf "%.0f" .DistanceMiles}} miles</span>
                            </div>
                            {{end}}
                            {{if gt .MovementSpeed 0}}
                            <div class="storm-detail storm-detail--full-width">
                                <span class="detail-label">Movement:</span>
                                <span class="detail-value">{{.MovementDir}} at {{.MovementSpeed}} mph</span>
                            </div>
                            {{end}}
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{/* Tornado Warnings */}}
            {{if .Data.TornadoWarnings}}
            <div class="alert-section">
                <div class="section-header">
                    <span class="section-icon">üå™Ô∏è</span>
                    <span class="section-title">Tornado Warnings</span>
                    <span class="section-count">{{len .Data.TornadoWarnings}}</span>
                </div>
                <div class="alerts-grid">
                    {{range .Data.TornadoWarnings}}
                    <div class="alert-card {{.Severity | lower}}">
                        {{if gt .DistanceMiles 0}}
                        <div class="alert-distance">{{printf "%.0f" .DistanceMiles}} mi</div>
                        {{end}}
                        <div class="alert-event">üå™Ô∏è {{.Event}}</div>
                        <div class="alert-meta">
                            <span>Severity: <strong>{{.Severity}}</strong></span>
                            <span>Urgency: <strong>{{.Urgency}}</strong></span>
                        </div>
                        <div class="alert-area">üìç {{.AreaDesc}}</div>
                        {{if .Headline}}
                        <div class="alert-headline">{{.Headline}}</div>
                        {{end}}
                        {{if .Description}}
                        <div class="alert-details">
                            <div class="alert-detail__title">Details:</div>
                            <div class="alert-detail__content">{{.Description}}</div>
                            {{if .Instruction}}
                            <div class="alert-detail__instruction-title">Instructions:</div>
                            <div class="alert-detail__content">{{.Instruction}}</div>
                            {{end}}
                            {{if .Expires}}
                            <div class="alert-detail__expires">Expires: {{.Expires}}</div>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{/* Severe Thunderstorms */}}
            {{if .Data.SevereStorms}}
            <div class="alert-section">
                <div class="section-header">
                    <span class="section-icon">‚õàÔ∏è</span>
                    <span class="section-title">Severe Thunderstorm Warnings</span>
                    <span class="section-count">{{len .Data.SevereStorms}}</span>
                </div>
                <div class="alerts-grid">
                    {{range .Data.SevereStorms}}
                    <div class="alert-card {{.Severity | lower}}">
                        {{if gt .DistanceMiles 0}}
                        <div class="alert-distance">{{printf "%.0f" .DistanceMiles}} mi</div>
                        {{end}}
                        <div class="alert-event">‚õàÔ∏è {{.Event}}</div>
                        <div class="alert-meta">
                            <span>Severity: <strong>{{.Severity}}</strong></span>
                            <span>Urgency: <strong>{{.Urgency}}</strong></span>
                        </div>
                        <div class="alert-area">üìç {{.AreaDesc}}</div>
                        {{if .Headline}}
                        <div class="alert-headline">{{.Headline}}</div>
                        {{end}}
                        {{if .Description}}
                        <div class="alert-details">
                            <div class="alert-detail__title">Details:</div>
                            <div class="alert-detail__content">{{.Description}}</div>
                            {{if .Instruction}}
                            <div class="alert-detail__instruction-title">Instructions:</div>
                            <div class="alert-detail__content">{{.Instruction}}</div>
                            {{end}}
                            {{if .Expires}}
                            <div class="alert-detail__expires">Expires: {{.Expires}}</div>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{/* Winter Storms */}}
            {{if .Data.WinterStorms}}
            <div class="alert-section">
                <div class="section-header">
                    <span class="section-icon">‚ùÑÔ∏è</span>
                    <span class="section-title">Winter Storm Warnings</span>
                    <span class="section-count">{{len .Data.WinterStorms}}</span>
                </div>
                <div class="alerts-grid">
                    {{range .Data.WinterStorms}}
                    <div class="alert-card {{.Severity | lower}}">
                        {{if gt .DistanceMiles 0}}
                        <div class="alert-distance">{{printf "%.0f" .DistanceMiles}} mi</div>
                        {{end}}
                        <div class="alert-event">‚ùÑÔ∏è {{.Event}}</div>
                        <div class="alert-meta">
                            <span>Severity: <strong>{{.Severity}}</strong></span>
                            <span>Urgency: <strong>{{.Urgency}}</strong></span>
                        </div>
                        <div class="alert-area">üìç {{.AreaDesc}}</div>
                        {{if .Headline}}
                        <div class="alert-headline">{{.Headline}}</div>
                        {{end}}
                        {{if .Description}}
                        <div class="alert-details">
                            <div class="alert-detail__title">Details:</div>
                            <div class="alert-detail__content">{{.Description}}</div>
                            {{if .Instruction}}
                            <div class="alert-detail__instruction-title">Instructions:</div>
                            <div class="alert-detail__content">{{.Instruction}}</div>
                            {{end}}
                            {{if .Expires}}
                            <div class="alert-detail__expires">Expires: {{.Expires}}</div>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{/* Flood Warnings */}}
            {{if .Data.FloodWarnings}}
            <div class="alert-section">
                <div class="section-header">
                    <span class="section-icon">üåä</span>
                    <span class="section-title">Flood Warnings</span>
                    <span class="section-count">{{len .Data.FloodWarnings}}</span>
                </div>
                <div class="alerts-grid">
                    {{range .Data.FloodWarnings}}
                    <div class="alert-card {{.Severity | lower}}">
                        {{if gt .DistanceMiles 0}}
                        <div class="alert-distance">{{printf "%.0f" .DistanceMiles}} mi</div>
                        {{end}}
                        <div class="alert-event">üåä {{.Event}}</div>
                        <div class="alert-meta">
                            <span>Severity: <strong>{{.Severity}}</strong></span>
                            <span>Urgency: <strong>{{.Urgency}}</strong></span>
                        </div>
                        <div class="alert-area">üìç {{.AreaDesc}}</div>
                        {{if .Headline}}
                        <div class="alert-headline">{{.Headline}}</div>
                        {{end}}
                        {{if .Description}}
                        <div class="alert-details">
                            <div class="alert-detail__title">Details:</div>
                            <div class="alert-detail__content">{{.Description}}</div>
                            {{if .Instruction}}
                            <div class="alert-detail__instruction-title">Instructions:</div>
                            <div class="alert-detail__content">{{.Instruction}}</div>
                            {{end}}
                            {{if .Expires}}
                            <div class="alert-detail__expires">Expires: {{.Expires}}</div>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{/* Other Alerts */}}
            {{if .Data.OtherAlerts}}
            <div class="alert-section">
                <div class="section-header">
                    <span class="section-icon">‚ö†Ô∏è</span>
                    <span class="section-title">Other Weather Alerts</span>
                    <span class="section-count">{{len .Data.OtherAlerts}}</span>
                </div>
                <div class="alerts-grid">
                    {{range .Data.OtherAlerts}}
                    <div class="alert-card {{.Severity | lower}}">
                        {{if gt .DistanceMiles 0}}
                        <div class="alert-distance">{{printf "%.0f" .DistanceMiles}} mi</div>
                        {{end}}
                        <div class="alert-event">‚ö†Ô∏è {{.Event}}</div>
                        <div class="alert-meta">
                            <span>Severity: <strong>{{.Severity}}</strong></span>
                            <span>Urgency: <strong>{{.Urgency}}</strong></span>
                        </div>
                        <div class="alert-area">üìç {{.AreaDesc}}</div>
                        {{if .Headline}}
                        <div class="alert-headline">{{.Headline}}</div>
                        {{end}}
                        {{if .Description}}
                        <div class="alert-details">
                            <div class="alert-detail__title">Details:</div>
                            <div class="alert-detail__content">{{.Description}}</div>
                            {{if .Instruction}}
                            <div class="alert-detail__instruction-title">Instructions:</div>
                            <div class="alert-detail__content">{{.Instruction}}</div>
                            {{end}}
                            {{if .Expires}}
                            <div class="alert-detail__expires">Expires: {{.Expires}}</div>
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{/* No Alerts Message */}}
            {{if and (not .Data.Hurricanes) (not .Data.TornadoWarnings) (not .Data.SevereStorms) (not .Data.WinterStorms) (not .Data.FloodWarnings) (not .Data.OtherAlerts)}}
            <div class="no-alerts">
                <div class="no-alerts-icon">üå§Ô∏è</div>
                <h2 class="all-clear__title">All Clear!</h2>
                <p class="all-clear__message">No active severe weather alerts in your area.</p>
                <p class="all-clear__note">Enjoying calm weather conditions üåà</p>
                {{if .HasLocation}}
                <p class="all-clear__location-info">
                    Monitoring within {{.Distance}} miles of {{.LocationName}}
                </p>
                {{end}}
            </div>
            {{end}}

        {{else}}
            <div class="no-alerts">
                <div class="no-alerts-icon">‚ö†Ô∏è</div>
                <h2>Unable to Load Weather Data</h2>
                <p class="all-clear__message">Please try again later.</p>
            </div>
        {{end}}

        <div class="data-source-box">
            <p class="data-source-box__primary">
                Data provided by <strong>NOAA</strong> and the <strong>National Weather Service</strong>
            </p>
            <p class="data-source-box__meta">
                Updates every 5 minutes ‚Ä¢ Last updated: {{.Data.LastUpdate}}
            </p>
        </div>
    </div>

    <script>
        function updateLocation() {
            const location = document.getElementById('location-input').value.trim();
            const type = document.getElementById('type-select').value;
            const distance = document.getElementById('distance-select').value;

            // Build URL based on type selection
            let url;
            if (type === 'all') {
                // Use /severe-weather route
                url = location ? `/severe-weather/${encodeURIComponent(location)}` : '/severe-weather';
            } else {
                // Use /severe/{type} route
                url = location ? `/severe/${type}/${encodeURIComponent(location)}` : `/severe/${type}`;
            }

            // Add distance parameter if not default (50)
            if (distance && distance !== '50') {
                url += `?distance=${distance}`;
            }

            window.location.href = url;
        }

        // Allow Enter key to submit
        document.getElementById('location-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                updateLocation();
            }
        });

        // Set selected filters from URL
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const distanceParam = urlParams.get('distance');

            // Set distance
            if (distanceParam) {
                const distanceSelect = document.getElementById('distance-select');
                if (distanceSelect) {
                    distanceSelect.value = distanceParam;
                }
            }

            // Detect type from URL path
            const path = window.location.pathname;
            const typeMatch = path.match(/\/severe\/(\w+)/);
            if (typeMatch) {
                const typeSelect = document.getElementById('type-select');
                if (typeSelect) {
                    typeSelect.value = typeMatch[1];
                }
            }
        });

        // Make alert cards clickable to expand/collapse details
        document.addEventListener('DOMContentLoaded', function() {
            const alertCards = document.querySelectorAll('.alert-card');

            alertCards.forEach(card => {
                card.addEventListener('click', function() {
                    const details = this.querySelector('.alert-details');
                    if (details) {
                        details.classList.toggle('show');
                    }
                });
            });
        });
    </script>

    {{template "footer" .}}
</body>
</html>
