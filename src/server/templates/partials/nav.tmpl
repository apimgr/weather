{{define "navbar"}}
<nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="navbar-container">
        <!-- Brand Logo -->
        <a href="/" class="navbar-brand" aria-label="{{.server.Title}} home page" title="Go to home page">
            <span class="navbar-brand-icon" aria-hidden="true">üå§Ô∏è</span>
            <span class="navbar-brand-text">{{.server.Title}}</span>
        </a>

        <!-- Desktop Navigation Menu -->
        <div class="navbar-menu" role="menubar">
            <a href="/" class="navbar-link {{if eq .page "weather"}}active{{end}}" role="menuitem" aria-label="Home page - Current weather" title="View current weather conditions">Home</a>
            <a href="/moon" class="navbar-link {{if eq .page "moon"}}active{{end}}" role="menuitem" aria-label="Moon phases" title="View moon phases and lunar information">Moon</a>
            <a href="/severe-weather" class="navbar-link {{if eq .page "severe-weather"}}active{{end}}" role="menuitem" aria-label="Severe weather alerts" title="View severe weather alerts and warnings">Severe Weather</a>
            <a href="/earthquake" class="navbar-link {{if eq .page "earthquake"}}active{{end}}" role="menuitem" aria-label="Recent earthquakes" title="View recent earthquake activity">Earthquakes</a>
            <a href="/user/dashboard" class="navbar-link {{if eq .page "dashboard"}}active{{end}}" role="menuitem" aria-label="User dashboard" title="View your saved locations and preferences">Dashboard</a>
        </div>

        <!-- Right Side Actions -->
        <div class="navbar-actions">
            <!-- Notification Bell (WebUI Notification System) -->
            <div class="notification-bell-wrapper">
                <a href="#" id="notification-bell" class="notification-bell" title="Notifications" aria-label="Notifications" aria-describedby="notification-badge">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                    </svg>
                    <span id="notification-badge" class="hidden" aria-live="polite" role="status"></span>
                </a>
                <!-- Notification center dropdown will be inserted here by notifications.js -->
            </div>

            <!-- Profile Avatar with Dropdown -->
            <div class="profile-avatar">
                <button class="avatar" onclick="Dropdown.toggle('profile-dropdown', 'profile-avatar')" id="profile-avatar" aria-label="User menu" aria-haspopup="true" aria-expanded="false" title="Open user menu - Access profile, notifications, and logout" role="button" tabindex="0" onkeydown="if(event.key==='Enter'||event.key===' '){Dropdown.toggle('profile-dropdown','profile-avatar');event.preventDefault();}">
                    {{if .user.Email}}
                        {{ index .user.Email 0 | printf "%c" | upper }}
                    {{else}}
                        U
                    {{end}}
                </button>
                <div class="profile-dropdown" id="profile-dropdown" role="menu" aria-labelledby="profile-avatar">
                    <div class="profile-dropdown-header">
                        <div>
                            {{if .user.Email}}
                                {{if .user.DisplayName}}
                                    {{.user.DisplayName}}
                                {{else if .user.Username}}
                                    {{.user.Username}}
                                {{else}}
                                    {{.user.Email}}
                                {{end}}
                            {{else}}
                                Guest
                            {{end}}
                        </div>
                        <div class="profile-dropdown-role">
                            {{if .user.Role}}
                                {{if ne .user.Role "guest"}}
                                    {{.user.Role}}
                                {{else}}
                                    Not logged in
                                {{end}}
                            {{else}}
                                Not logged in
                            {{end}}
                        </div>
                    </div>
                    <nav class="profile-dropdown-menu">
                        <a href="/profile" class="profile-dropdown-item" role="menuitem" title="View and edit your profile settings">üë§ Profile</a>
                        <a href="/notifications" class="profile-dropdown-item" role="menuitem" title="View all notifications and alerts">üîî Notifications</a>
                        <a href="/docs" class="profile-dropdown-item" role="menuitem" title="API documentation and developer guides">üìö API Docs</a>
                        <a href="/auth/logout" class="profile-dropdown-item" role="menuitem" title="Sign out of your account">üö™ Logout</a>
                    </nav>
                </div>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" onclick="Dropdown.toggle('mobile-menu', 'mobile-menu-toggle')" id="mobile-menu-toggle" aria-label="Toggle mobile navigation menu" aria-expanded="false" aria-controls="mobile-menu" title="Open mobile navigation menu" onkeydown="if(event.key==='Enter'||event.key===' '){Dropdown.toggle('mobile-menu','mobile-menu-toggle');event.preventDefault();}">
                ‚ò∞
            </button>
        </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-menu" id="mobile-menu" role="menu" aria-label="Mobile navigation">
        <a href="/" class="mobile-menu-item" role="menuitem" title="View current weather">Home</a>
        <a href="/moon" class="mobile-menu-item" role="menuitem" title="View moon phases">Moon</a>
        <a href="/severe-weather" class="mobile-menu-item" role="menuitem" title="View severe weather alerts">Severe Weather</a>
        <a href="/earthquake" class="mobile-menu-item" role="menuitem" title="View earthquakes">Earthquakes</a>
        <a href="/user/dashboard" class="mobile-menu-item" role="menuitem" title="View your dashboard">Dashboard</a>
    </div>
</nav>

<script>
    // Initialize notifications on page load
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof Notifications !== 'undefined') {
            Notifications.fetch();
            Notifications.startPolling(60000);
        }
    });
</script>
{{end}}
