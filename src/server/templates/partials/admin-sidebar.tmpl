<!-- Admin Sidebar per AI.md PART 18 -->
<aside class="admin-sidebar" id="adminSidebar">
    <nav class="sidebar-nav">
        <!-- Dashboard -->
        <div class="nav-section">
            <a href="/admin/dashboard" class="nav-item{{ if eq .currentPage "dashboard" }} active{{ end }}">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                <span class="nav-text">Dashboard</span>
            </a>
        </div>

        <!-- Server Section per AI.md PART 18 -->
        <div class="nav-section">
            <button class="nav-section-header" onclick="toggleSection(this)" data-section="server">
                <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                    <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                    <line x1="6" y1="6" x2="6.01" y2="6"></line>
                    <line x1="6" y1="18" x2="6.01" y2="18"></line>
                </svg>
                <span class="section-text">Server</span>
                <svg class="section-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="nav-section-content" data-section="server">
                <a href="/admin/server/settings" class="nav-subitem{{ if eq .currentPage "server-settings" }} active{{ end }}">Settings</a>
                <a href="/admin/server/branding" class="nav-subitem{{ if eq .currentPage "server-branding" }} active{{ end }}">Branding</a>
                <a href="/admin/server/ssl" class="nav-subitem{{ if eq .currentPage "server-ssl" }} active{{ end }}">SSL/TLS</a>
                <a href="/admin/server/scheduler" class="nav-subitem{{ if eq .currentPage "server-scheduler" }} active{{ end }}">Scheduler</a>
                <a href="/admin/server/email" class="nav-subitem{{ if eq .currentPage "server-email" }} active{{ end }}">Email</a>
                <a href="/admin/server/logs" class="nav-subitem{{ if eq .currentPage "server-logs" }} active{{ end }}">Logs</a>
                <a href="/admin/server/backup" class="nav-subitem{{ if eq .currentPage "server-backup" }} active{{ end }}">Backup</a>
                <a href="/admin/server/maintenance" class="nav-subitem{{ if eq .currentPage "server-maintenance" }} active{{ end }}">Maintenance</a>
                <a href="/admin/server/updates" class="nav-subitem{{ if eq .currentPage "server-updates" }} active{{ end }}">Updates</a>
                <a href="/admin/server/info" class="nav-subitem{{ if eq .currentPage "server-info" }} active{{ end }}">Info</a>
            </div>
        </div>

        <!-- Security Section per AI.md PART 18 -->
        <div class="nav-section">
            <button class="nav-section-header" onclick="toggleSection(this)" data-section="security">
                <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                <span class="section-text">Security</span>
                <svg class="section-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="nav-section-content" data-section="security">
                <a href="/admin/security/auth" class="nav-subitem{{ if eq .currentPage "security-auth" }} active{{ end }}">Authentication</a>
                <a href="/admin/security/tokens" class="nav-subitem{{ if eq .currentPage "security-tokens" }} active{{ end }}">API Tokens</a>
                <a href="/admin/security/ratelimit" class="nav-subitem{{ if eq .currentPage "security-ratelimit" }} active{{ end }}">Rate Limiting</a>
                <a href="/admin/security/firewall" class="nav-subitem{{ if eq .currentPage "security-firewall" }} active{{ end }}">Firewall</a>
            </div>
        </div>

        <!-- Network Section per AI.md PART 18 -->
        <div class="nav-section">
            <button class="nav-section-header" onclick="toggleSection(this)" data-section="network">
                <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="2" y1="12" x2="22" y2="12"></line>
                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
                <span class="section-text">Network</span>
                <svg class="section-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="nav-section-content" data-section="network">
                <a href="/admin/network/tor" class="nav-subitem{{ if eq .currentPage "network-tor" }} active{{ end }}">Tor</a>
                <a href="/admin/network/geoip" class="nav-subitem{{ if eq .currentPage "network-geoip" }} active{{ end }}">GeoIP</a>
                <a href="/admin/network/blocklists" class="nav-subitem{{ if eq .currentPage "network-blocklists" }} active{{ end }}">Blocklists</a>
            </div>
        </div>

        <!-- Users Section per AI.md PART 18 (if multi-user) -->
        {{ if .multiUserEnabled }}
        <div class="nav-section">
            <button class="nav-section-header" onclick="toggleSection(this)" data-section="users">
                <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <span class="section-text">Users</span>
                <svg class="section-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="nav-section-content" data-section="users">
                <a href="/admin/users" class="nav-subitem{{ if eq .currentPage "users-list" }} active{{ end }}">User List</a>
                <a href="/admin/users/invites" class="nav-subitem{{ if eq .currentPage "users-invites" }} active{{ end }}">Invites</a>
                <a href="/admin/users/roles" class="nav-subitem{{ if eq .currentPage "users-roles" }} active{{ end }}">Roles</a>
            </div>
        </div>
        {{ end }}

        <!-- Cluster Section per AI.md PART 18 (if enabled) -->
        {{ if .clusterEnabled }}
        <div class="nav-section">
            <button class="nav-section-header" onclick="toggleSection(this)" data-section="cluster">
                <svg class="section-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="5" r="3"></circle>
                    <circle cx="12" cy="19" r="3"></circle>
                    <circle cx="5" cy="12" r="3"></circle>
                    <circle cx="19" cy="12" r="3"></circle>
                    <line x1="12" y1="8" x2="12" y2="16"></line>
                    <line x1="8" y1="12" x2="16" y2="12"></line>
                </svg>
                <span class="section-text">Cluster</span>
                <svg class="section-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="nav-section-content" data-section="cluster">
                <a href="/admin/cluster/nodes" class="nav-subitem{{ if eq .currentPage "cluster-nodes" }} active{{ end }}">Nodes</a>
                <a href="/admin/cluster/add" class="nav-subitem{{ if eq .currentPage "cluster-add" }} active{{ end }}">Add Node</a>
                <a href="/admin/cluster/settings" class="nav-subitem{{ if eq .currentPage "cluster-settings" }} active{{ end }}">Settings</a>
            </div>
        </div>
        {{ end }}

        <!-- Help Section per AI.md PART 18 -->
        <div class="nav-section">
            <a href="/admin/help" class="nav-item{{ if eq .currentPage "help" }} active{{ end }}">
                <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span class="nav-text">Help</span>
            </a>
        </div>
    </nav>
</aside>

<script>
// Sidebar navigation JavaScript per AI.md PART 18
function toggleSidebar() {
    const sidebar = document.getElementById('adminSidebar');
    sidebar.classList.toggle('collapsed');
    localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
}

function toggleSection(button) {
    const section = button.dataset.section;
    const content = button.parentElement.querySelector('.nav-section-content');
    const isExpanded = content.classList.contains('expanded');

    content.classList.toggle('expanded');
    button.classList.toggle('expanded');

    // Persist state per AI.md PART 18
    const expandedSections = JSON.parse(localStorage.getItem('expandedSections') || '[]');
    if (isExpanded) {
        const index = expandedSections.indexOf(section);
        if (index > -1) expandedSections.splice(index, 1);
    } else {
        if (!expandedSections.includes(section)) expandedSections.push(section);
    }
    localStorage.setItem('expandedSections', JSON.stringify(expandedSections));
}

// Restore sidebar state on load per AI.md PART 18
document.addEventListener('DOMContentLoaded', function() {
    // Restore collapsed state
    if (localStorage.getItem('sidebarCollapsed') === 'true') {
        document.getElementById('adminSidebar').classList.add('collapsed');
    }

    // Restore expanded sections
    const expandedSections = JSON.parse(localStorage.getItem('expandedSections') || '[]');
    expandedSections.forEach(section => {
        const header = document.querySelector(`[data-section="${section}"]`);
        if (header) {
            const content = header.parentElement.querySelector('.nav-section-content');
            content.classList.add('expanded');
            header.classList.add('expanded');
        }
    });
});
</script>
