{{template "head" .}}

{{template "navbar" .}}

    <!-- Main Content -->
    <main class="container">
        <div class="admin-header">
            <h1>‚öôÔ∏è Server Settings</h1>
            <p class="subtitle">Configure your weather service</p>
        </div>

        <!-- Settings Tabs -->
        <div class="tabs" role="tablist" aria-label="Settings categories">
            <button class="tab active"
                    onclick="switchSettingsTab('server')"
                    role="tab"
                    aria-selected="true"
                    aria-controls="tab-server"
                    aria-label="Server settings"
                    title="Configure server branding, ports, timezone, and date/time formats">üè† Server</button>
            <button class="tab"
                    onclick="switchSettingsTab('security')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-security"
                    aria-label="Security settings"
                    title="Configure authentication, session timeout, login attempts, and password requirements">üîí Security</button>
            <button class="tab"
                    onclick="switchSettingsTab('features')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-features"
                    aria-label="Feature settings"
                    title="Enable or disable user registration, API access, and weather alerts">‚ú® Features</button>
            <button class="tab"
                    onclick="switchSettingsTab('backup')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-backup"
                    aria-label="Backup settings"
                    title="Configure automatic database backups, retention, and storage location">üíæ Backup</button>
            <button class="tab"
                    onclick="switchSettingsTab('logging')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-logging"
                    aria-label="Logging settings"
                    title="Configure log levels, formats, and rotation for access, error, and audit logs">üìù Logging</button>
            <button class="tab"
                    onclick="switchSettingsTab('smtp')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-smtp"
                    aria-label="Email settings"
                    title="Configure SMTP server for email notifications and alerts">üìß Email</button>
            <button class="tab"
                    onclick="switchSettingsTab('ratelimit')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-ratelimit"
                    aria-label="Rate limiting settings"
                    title="Configure rate limits to prevent API abuse">üö¶ Rate Limits</button>
            <button class="tab"
                    onclick="switchSettingsTab('ssl')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-ssl"
                    aria-label="SSL/TLS settings"
                    title="Configure SSL certificates and HTTPS encryption">üîê SSL/TLS</button>
            <button class="tab"
                    onclick="switchSettingsTab('weather')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-weather"
                    aria-label="Weather settings"
                    title="Configure weather data refresh intervals and caching">üå§Ô∏è Weather</button>
            <button class="tab"
                    onclick="switchSettingsTab('notifications')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-notifications"
                    aria-label="Notification settings"
                    title="Configure notification system and queue processing">üîî Notifications</button>
            <button class="tab"
                    onclick="switchSettingsTab('advanced')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-advanced"
                    aria-label="Advanced settings"
                    title="Configure GeoIP, CORS, and scheduled tasks">‚öôÔ∏è Advanced</button>
            <button class="tab"
                    onclick="switchSettingsTab('tor')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-tor"
                    aria-label="Tor hidden service settings"
                    title="Configure Tor hidden service for anonymous .onion access">üßÖ Tor</button>
            <button class="tab"
                    onclick="switchSettingsTab('history')"
                    role="tab"
                    aria-selected="false"
                    aria-controls="tab-history"
                    aria-label="Historical weather settings"
                    title="Configure historical weather data feature">üìä History</button>
        </div>

        <!-- Server Tab -->
        <div id="tab-server" class="tab-content active" role="tabpanel" aria-labelledby="tab-server">
            <div class="card">
                <h2>Server Branding</h2>
                <form id="form-server-branding"
                      onsubmit="saveSettings(event, 'server-branding')"
                      role="form"
                      aria-label="Server branding settings">
                    <div class="form-group">
                        <label for="server_title">Server Title</label>
                        <input type="text"
                               id="server_title"
                               name="server.title"
                               value="{{.settings.server_title}}"
                               placeholder="Weather Service"
                               aria-label="Server title"
                               aria-describedby="server_title_help"
                               title="The main title displayed in the header and browser tabs (e.g., 'Weather Service', 'My Weather Station')">
                        <small id="server_title_help">Displayed in the header and page titles</small>
                    </div>

                    <div class="form-group">
                        <label for="server_tagline">Tagline</label>
                        <input type="text"
                               id="server_tagline"
                               name="server.tagline"
                               value="{{.settings.server_tagline}}"
                               placeholder="Your personal weather dashboard"
                               aria-label="Server tagline"
                               aria-describedby="server_tagline_help"
                               title="A short subtitle or slogan shown under the title (e.g., 'Your personal weather dashboard')">
                        <small id="server_tagline_help">Short subtitle shown under the title</small>
                    </div>

                    <div class="form-group">
                        <label for="server_description">Description</label>
                        <textarea id="server_description"
                                  name="server.description"
                                  rows="3"
                                  placeholder="A comprehensive platform for weather forecasts..."
                                  aria-label="Server description"
                                  aria-describedby="server_description_help"
                                  title="Full description of your weather service for the about page and search engine meta tags">{{.settings.server_description}}</textarea>
                        <small id="server_description_help">Full description for about page and meta tags</small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save branding settings"
                            title="Save changes to server branding (title, tagline, description)">Save Branding</button>
                </form>
            </div>

            <div class="card">
                <h2>Server Configuration</h2>
                <form id="form-server-config"
                      onsubmit="saveSettings(event, 'server-config')"
                      role="form"
                      aria-label="Server configuration settings">
                    <div class="form-group">
                        <label for="server_http_port">HTTP Port</label>
                        <input type="number"
                               id="server_http_port"
                               name="server.http_port"
                               value="{{.settings.server_http_port}}"
                               min="1"
                               max="65535"
                               aria-label="HTTP port number"
                               aria-required="true"
                               aria-describedby="server_http_port_help"
                               title="Port number for HTTP connections (1-65535) - changing this requires a server restart">
                        <small id="server_http_port_help">Port for HTTP connections (requires restart)</small>
                    </div>

                    <div class="form-group">
                        <label for="server_https_port">HTTPS Port</label>
                        <input type="number"
                               id="server_https_port"
                               name="server.https_port"
                               value="{{.settings.server_https_port}}"
                               min="0"
                               max="65535"
                               aria-label="HTTPS port number"
                               aria-describedby="server_https_port_help"
                               title="Port number for HTTPS connections (0-65535) - set to 0 to disable HTTPS, requires server restart">
                        <small id="server_https_port_help">Port for HTTPS connections (0 to disable, requires restart)</small>
                    </div>

                    <div class="form-group">
                        <label for="server_timezone">Server Timezone</label>
                        <select id="server_timezone"
                                name="server.timezone"
                                aria-label="Server timezone"
                                aria-describedby="server_timezone_help"
                                title="IANA timezone identifier - sets the default timezone for displaying times across the server">
                            <option value="America/New_York" {{if eq .settings.server_timezone "America/New_York"}}selected{{end}}>America/New_York (EST/EDT)</option>
                            <option value="America/Chicago" {{if eq .settings.server_timezone "America/Chicago"}}selected{{end}}>America/Chicago (CST/CDT)</option>
                            <option value="America/Denver" {{if eq .settings.server_timezone "America/Denver"}}selected{{end}}>America/Denver (MST/MDT)</option>
                            <option value="America/Los_Angeles" {{if eq .settings.server_timezone "America/Los_Angeles"}}selected{{end}}>America/Los_Angeles (PST/PDT)</option>
                            <option value="Europe/London" {{if eq .settings.server_timezone "Europe/London"}}selected{{end}}>Europe/London (GMT/BST)</option>
                            <option value="Europe/Paris" {{if eq .settings.server_timezone "Europe/Paris"}}selected{{end}}>Europe/Paris (CET/CEST)</option>
                            <option value="Asia/Tokyo" {{if eq .settings.server_timezone "Asia/Tokyo"}}selected{{end}}>Asia/Tokyo (JST)</option>
                            <option value="UTC" {{if eq .settings.server_timezone "UTC"}}selected{{end}}>UTC</option>
                        </select>
                        <small id="server_timezone_help">Default timezone for the server</small>
                    </div>

                    <div class="form-group">
                        <label for="server_date_format">Date Format</label>
                        <select id="server_date_format"
                                name="server.date_format"
                                aria-label="Date format preference"
                                aria-describedby="server_date_format_help"
                                title="Choose how dates are displayed - US format (Jan 1, 2024), EU format (1 Jan 2024), or ISO format (2024-01-01)">
                            <option value="US" {{if eq .settings.server_date_format "US"}}selected{{end}}>US (Jan 1, 2024)</option>
                            <option value="EU" {{if eq .settings.server_date_format "EU"}}selected{{end}}>EU (1 Jan 2024)</option>
                            <option value="ISO" {{if eq .settings.server_date_format "ISO"}}selected{{end}}>ISO (2024-01-01)</option>
                        </select>
                        <small id="server_date_format_help">How dates are displayed throughout the site</small>
                    </div>

                    <div class="form-group">
                        <label for="server_time_format">Time Format</label>
                        <select id="server_time_format"
                                name="server.time_format"
                                aria-label="Time format preference"
                                aria-describedby="server_time_format_help"
                                title="Choose between 12-hour format (3:30 PM) or 24-hour format (15:30) for displaying times">
                            <option value="12-hour" {{if eq .settings.server_time_format "12-hour"}}selected{{end}}>12-hour (3:30 PM)</option>
                            <option value="24-hour" {{if eq .settings.server_time_format "24-hour"}}selected{{end}}>24-hour (15:30)</option>
                        </select>
                        <small id="server_time_format_help">How times are displayed throughout the site</small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save configuration settings"
                            title="Save changes to server configuration (ports, timezone, date/time formats)">Save Configuration</button>
                </form>
            </div>
        </div>

        <!-- Security Tab -->
        <div id="tab-security" class="tab-content" role="tabpanel" aria-labelledby="tab-security">
            <div class="card">
                <h2>Authentication & Sessions</h2>
                <form id="form-security"
                      onsubmit="saveSettings(event, 'security')"
                      role="form"
                      aria-label="Security and authentication settings">
                    <div class="form-group">
                        <label for="security_session_timeout">Session Timeout (seconds)</label>
                        <input type="number"
                               id="security_session_timeout"
                               name="security.session_timeout"
                               value="{{.settings.security_session_timeout}}"
                               min="60"
                               aria-label="Session timeout in seconds"
                               aria-required="true"
                               aria-describedby="security_session_timeout_help"
                               title="How long user sessions remain active in seconds (minimum 60) - default is 2592000 (30 days)">
                        <small id="security_session_timeout_help">Default: 2592000 (30 days)</small>
                    </div>

                    <div class="form-group">
                        <label for="security_max_login_attempts">Max Login Attempts</label>
                        <input type="number"
                               id="security_max_login_attempts"
                               name="security.max_login_attempts"
                               value="{{.settings.security_max_login_attempts}}"
                               min="1"
                               aria-label="Maximum login attempts before lockout"
                               aria-required="true"
                               aria-describedby="security_max_login_attempts_help"
                               title="Maximum number of failed login attempts before an account is temporarily locked">
                        <small id="security_max_login_attempts_help">Failed attempts before temporary account lockout</small>
                    </div>

                    <div class="form-group">
                        <label for="security_lockout_duration">Lockout Duration (minutes)</label>
                        <input type="number"
                               id="security_lockout_duration"
                               name="security.lockout_duration"
                               value="{{.settings.security_lockout_duration}}"
                               min="1"
                               aria-label="Account lockout duration in minutes"
                               aria-required="true"
                               aria-describedby="security_lockout_duration_help"
                               title="How long an account remains locked after exceeding max login attempts (in minutes)">
                        <small id="security_lockout_duration_help">How long accounts remain locked after failed attempts</small>
                    </div>

                    <div class="form-group">
                        <label for="security_password_min_length">Minimum Password Length</label>
                        <input type="number"
                               id="security_password_min_length"
                               name="security.password_min_length"
                               value="{{.settings.security_password_min_length}}"
                               min="6"
                               aria-label="Minimum password length"
                               aria-required="true"
                               aria-describedby="security_password_min_length_help"
                               title="Minimum number of characters required for user passwords (minimum 6, recommended 8+)">
                        <small id="security_password_min_length_help">Minimum characters required for passwords (recommended: 8+)</small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save security settings"
                            title="Save changes to security and authentication settings">Save Security Settings</button>
                </form>
            </div>
        </div>

        <!-- Features Tab -->
        <div id="tab-features" class="tab-content" role="tabpanel" aria-labelledby="tab-features">
            <div class="card">
                <h2>Feature Toggles</h2>
                <form id="form-features"
                      onsubmit="saveSettings(event, 'features')"
                      role="form"
                      aria-label="Feature toggle settings">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="features.registration_enabled"
                                   {{if .settings.features_registration_enabled}}checked{{end}}
                                   aria-label="Enable user registration"
                                   aria-describedby="features_registration_help"
                                   title="Allow new users to create accounts - disable to restrict registration to admin-created users only"
                                   role="switch"
                                   aria-checked="{{if .settings.features_registration_enabled}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">User Registration Enabled</span>
                        </label>
                        <small id="features_registration_help">Allow new users to register</small>
                    </div>

                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="features.api_enabled"
                                   {{if .settings.features_api_enabled}}checked{{end}}
                                   aria-label="Enable API access"
                                   aria-describedby="features_api_help"
                                   title="Enable JSON API endpoints for programmatic access to weather data"
                                   role="switch"
                                   aria-checked="{{if .settings.features_api_enabled}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">API Access Enabled</span>
                        </label>
                        <small id="features_api_help">Enable JSON API endpoints</small>
                    </div>

                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="features.weather_alerts"
                                   {{if .settings.features_weather_alerts}}checked{{end}}
                                   aria-label="Enable weather alerts"
                                   aria-describedby="features_weather_alerts_help"
                                   title="Enable severe weather alert notifications and warnings for users"
                                   role="switch"
                                   aria-checked="{{if .settings.features_weather_alerts}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Weather Alerts Enabled</span>
                        </label>
                        <small id="features_weather_alerts_help">Enable weather alert notifications</small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save feature settings"
                            title="Save changes to feature toggles (registration, API, weather alerts)">Save Feature Settings</button>
                </form>
            </div>
        </div>

        <!-- Backup Tab -->
        <div id="tab-backup" class="tab-content" role="tabpanel" aria-labelledby="tab-backup">
            <div class="card">
                <h2>Backup Configuration</h2>
                <form id="form-backup"
                      onsubmit="saveSettings(event, 'backup')"
                      role="form"
                      aria-label="Backup configuration settings">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="backup.enabled"
                                   {{if .settings.backup_enabled}}checked{{end}}
                                   aria-label="Enable automatic backups"
                                   aria-describedby="backup_enabled_help"
                                   title="Enable automated database backups at regular intervals"
                                   role="switch"
                                   aria-checked="{{if .settings.backup_enabled}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Automatic Backups Enabled</span>
                        </label>
                        <small id="backup_enabled_help">Enable scheduled automated backups</small>
                    </div>

                    <div class="form-group">
                        <label for="backup_interval">Backup Interval (hours)</label>
                        <input type="number"
                               id="backup_interval"
                               name="backup.interval"
                               value="{{.settings.backup_interval}}"
                               min="1"
                               aria-label="Backup interval in hours"
                               aria-required="true"
                               aria-describedby="backup_interval_help"
                               title="How often to create automated backups in hours (e.g., 24 for daily backups)">
                        <small id="backup_interval_help">How often to create backups (e.g., 24 for daily)</small>
                    </div>

                    <div class="form-group">
                        <label for="backup_retention">Backup Retention (days)</label>
                        <input type="number"
                               id="backup_retention"
                               name="backup.retention"
                               value="{{.settings.backup_retention}}"
                               min="1"
                               aria-label="Backup retention in days"
                               aria-required="true"
                               aria-describedby="backup_retention_help"
                               title="How many days to keep old backups before deletion (e.g., 30 for monthly retention)">
                        <small id="backup_retention_help">How long to keep backups before deletion</small>
                    </div>

                    <div class="form-group">
                        <label for="backup_location">Backup Location</label>
                        <input type="text"
                               id="backup_location"
                               name="backup.location"
                               value="{{.settings.backup_location}}"
                               aria-label="Backup storage location path"
                               aria-describedby="backup_location_help"
                               title="File system path where backup files are stored (e.g., /var/backups/weather or ./backups)">
                        <small id="backup_location_help">File path where backups are saved</small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save backup settings"
                            title="Save changes to backup configuration (interval, retention, location)">Save Backup Settings</button>
                </form>
            </div>
        </div>

        <!-- Logging Tab -->
        <div id="tab-logging" class="tab-content" role="tabpanel" aria-labelledby="tab-logging">
            <div class="card">
                <h2>Logging Configuration</h2>
                <form id="form-logging"
                      onsubmit="saveSettings(event, 'logging')"
                      role="form"
                      aria-label="Logging configuration settings">
                    <div class="form-group">
                        <label for="logging_level">Log Level</label>
                        <select id="logging_level"
                                name="logging.level"
                                aria-label="Log level"
                                aria-describedby="logging_level_help"
                                title="Minimum severity level for logging - Debug (all), Info (normal), Warn (warnings only), Error (errors only)">
                            <option value="debug" {{if eq .settings.logging_level "debug"}}selected{{end}}>Debug</option>
                            <option value="info" {{if eq .settings.logging_level "info"}}selected{{end}}>Info</option>
                            <option value="warn" {{if eq .settings.logging_level "warn"}}selected{{end}}>Warning</option>
                            <option value="error" {{if eq .settings.logging_level "error"}}selected{{end}}>Error</option>
                        </select>
                        <small id="logging_level_help">Minimum severity level to log (Debug shows all, Error shows only errors)</small>
                    </div>

                    <div class="form-group">
                        <label for="logging_format">Log Format</label>
                        <select id="logging_format"
                                name="logging.format"
                                aria-label="Log format"
                                aria-describedby="logging_format_help"
                                title="Format for log output - JSON (structured), Text (human-readable), Apache (web server standard)">
                            <option value="json" {{if eq .settings.logging_format "json"}}selected{{end}}>JSON</option>
                            <option value="text" {{if eq .settings.logging_format "text"}}selected{{end}}>Text</option>
                            <option value="apache" {{if eq .settings.logging_format "apache"}}selected{{end}}>Apache Combined</option>
                        </select>
                        <small id="logging_format_help">Format for log entries (JSON for parsing, Text for readability)</small>
                    </div>

                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="logging.access_log"
                                   {{if .settings.logging_access_log}}checked{{end}}
                                   aria-label="Enable access log"
                                   aria-describedby="logging_access_log_help"
                                   title="Log all HTTP requests and responses for monitoring traffic"
                                   role="switch"
                                   aria-checked="{{if .settings.logging_access_log}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Access Log Enabled</span>
                        </label>
                        <small id="logging_access_log_help">Log all HTTP requests and responses</small>
                    </div>

                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="logging.error_log"
                                   {{if .settings.logging_error_log}}checked{{end}}
                                   aria-label="Enable error log"
                                   aria-describedby="logging_error_log_help"
                                   title="Log application errors and exceptions for debugging"
                                   role="switch"
                                   aria-checked="{{if .settings.logging_error_log}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Error Log Enabled</span>
                        </label>
                        <small id="logging_error_log_help">Log errors and exceptions</small>
                    </div>

                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox"
                                   name="logging.audit_log"
                                   {{if .settings.logging_audit_log}}checked{{end}}
                                   aria-label="Enable audit log"
                                   aria-describedby="logging_audit_log_help"
                                   title="Log administrative actions and security-relevant events for compliance"
                                   role="switch"
                                   aria-checked="{{if .settings.logging_audit_log}}true{{else}}false{{end}}">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Audit Log Enabled</span>
                        </label>
                        <small id="logging_audit_log_help">Log administrative and security events</small>
                    </div>

                    <div class="form-group">
                        <label for="logging_rotation_days">Log Rotation (days)</label>
                        <input type="number"
                               id="logging_rotation_days"
                               name="logging.rotation_days"
                               value="{{.settings.logging_rotation_days}}"
                               min="1"
                               aria-label="Log rotation interval in days"
                               aria-required="true"
                               aria-describedby="logging_rotation_days_help"
                               title="How often to rotate and archive log files in days (e.g., 7 for weekly rotation)">
                        <small id="logging_rotation_days_help">How often to rotate log files (e.g., 7 for weekly)</small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save logging settings"
                            title="Save changes to logging configuration (level, format, enabled logs, rotation)">Save Logging Settings</button>
                </form>
            </div>
        </div>

        <!-- SMTP/Email Tab -->
        <div id="tab-smtp" class="tab-content" role="tabpanel" aria-labelledby="tab-smtp">
            <div class="card">
                <h2>üìß SMTP Configuration</h2>
                <form id="form-smtp" onsubmit="saveSettings(event, 'smtp')" role="form" aria-label="SMTP settings">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="smtp.enabled" {{if .settings.smtp_enabled}}checked{{end}}
                                   aria-label="Enable SMTP" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Email Notifications</span>
                        </label>
                        <small>Enable SMTP for sending email notifications and alerts</small>
                    </div>
                    <div class="form-group">
                        <label for="smtp_host">SMTP Host</label>
                        <input type="text" id="smtp_host" name="smtp.host" value="{{.settings.smtp_host}}"
                               placeholder="smtp.gmail.com" aria-label="SMTP hostname">
                        <small>SMTP server hostname or IP address</small>
                    </div>
                    <div class="form-group">
                        <label for="smtp_port">SMTP Port</label>
                        <input type="number" id="smtp_port" name="smtp.port" value="{{.settings.smtp_port}}"
                               min="1" max="65535" aria-label="SMTP port">
                        <small>Usually 587 (TLS) or 465 (SSL)</small>
                    </div>
                    <div class="form-group">
                        <label for="smtp_username">Username</label>
                        <input type="text" id="smtp_username" name="smtp.username" value="{{.settings.smtp_username}}"
                               aria-label="SMTP username">
                    </div>
                    <div class="form-group">
                        <label for="smtp_password">Password</label>
                        <input type="password" id="smtp_password" name="smtp.password" value="{{.settings.smtp_password}}"
                               aria-label="SMTP password">
                    </div>
                    <div class="form-group">
                        <label for="smtp_from_address">From Address</label>
                        <input type="email" id="smtp_from_address" name="smtp.from_address" value="{{.settings.smtp_from_address}}"
                               placeholder="noreply@example.com" aria-label="From email address">
                    </div>
                    <div class="form-group">
                        <label for="smtp_from_name">From Name</label>
                        <input type="text" id="smtp_from_name" name="smtp.from_name" value="{{.settings.smtp_from_name}}"
                               placeholder="Weather Service" aria-label="From name">
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="smtp.use_tls" {{if .settings.smtp_use_tls}}checked{{end}}
                                   aria-label="Use TLS" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Use TLS/STARTTLS</span>
                        </label>
                        <small>Enable secure connections via TLS</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save SMTP Settings</button>
                </form>
            </div>
        </div>

        <!-- Rate Limiting Tab -->
        <div id="tab-ratelimit" class="tab-content" role="tabpanel" aria-labelledby="tab-ratelimit">
            <div class="card">
                <h2>üö¶ Rate Limiting</h2>
                <form id="form-ratelimit" onsubmit="saveSettings(event, 'ratelimit')" role="form">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="rate_limit.enabled" {{if .settings.rate_limit_enabled}}checked{{end}}
                                   aria-label="Enable rate limiting" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Rate Limiting</span>
                        </label>
                        <small>Prevent API abuse by limiting request rates</small>
                    </div>
                    <div class="form-group">
                        <label for="rate_limit_global">Global Limit (req/sec)</label>
                        <input type="number" id="rate_limit_global" name="rate_limit.global" value="{{.settings.rate_limit_global}}" min="1">
                        <small>Global rate limit in requests per second</small>
                    </div>
                    <div class="form-group">
                        <label for="rate_limit_api">API Limit (req/15min)</label>
                        <input type="number" id="rate_limit_api" name="rate_limit.api" value="{{.settings.rate_limit_api}}" min="1">
                        <small>API rate limit per 15-minute window</small>
                    </div>
                    <div class="form-group">
                        <label for="rate_limit_admin">Admin Limit (req/15min)</label>
                        <input type="number" id="rate_limit_admin" name="rate_limit.admin" value="{{.settings.rate_limit_admin}}" min="1">
                        <small>Admin panel rate limit per 15-minute window</small>
                    </div>
                    <div class="form-group">
                        <label for="rate_limit_window">Window (seconds)</label>
                        <input type="number" id="rate_limit_window" name="rate_limit.window" value="{{.settings.rate_limit_window}}" min="60">
                        <small>Rate limit time window in seconds (default: 900 = 15 minutes)</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Rate Limit Settings</button>
                </form>
            </div>
        </div>

        <!-- SSL/TLS Tab -->
        <div id="tab-ssl" class="tab-content" role="tabpanel" aria-labelledby="tab-ssl">
            <div class="card">
                <h2>üîê SSL/TLS Configuration</h2>
                <form id="form-ssl" onsubmit="saveSettings(event, 'ssl')" role="form">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="ssl.enabled" {{if .settings.ssl_enabled}}checked{{end}}
                                   aria-label="Enable SSL/TLS" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable HTTPS</span>
                        </label>
                        <small>Enable SSL/TLS for secure HTTPS connections (requires restart)</small>
                    </div>
                    <div class="form-group">
                        <label for="ssl_cert_file">Certificate File Path</label>
                        <input type="text" id="ssl_cert_file" name="ssl.cert_file" value="{{.settings.ssl_cert_file}}"
                               placeholder="/etc/ssl/certs/cert.pem">
                        <small>Path to SSL certificate file</small>
                    </div>
                    <div class="form-group">
                        <label for="ssl_key_file">Private Key File Path</label>
                        <input type="text" id="ssl_key_file" name="ssl.key_file" value="{{.settings.ssl_key_file}}"
                               placeholder="/etc/ssl/private/key.pem">
                        <small>Path to SSL private key file</small>
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="ssl.acme_enabled" {{if .settings.ssl_acme_enabled}}checked{{end}}
                                   aria-label="Enable ACME" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Automatic Certificates (ACME)</span>
                        </label>
                        <small>Automatically obtain and renew certificates via Let's Encrypt</small>
                    </div>
                    <div class="form-group">
                        <label for="ssl_acme_email">ACME Email</label>
                        <input type="email" id="ssl_acme_email" name="ssl.acme_email" value="{{.settings.ssl_acme_email}}"
                               placeholder="admin@example.com">
                        <small>Email for ACME certificate registration</small>
                    </div>
                    <div class="form-group">
                        <label for="ssl_acme_provider">ACME Provider</label>
                        <select id="ssl_acme_provider" name="ssl.acme_provider">
                            <option value="letsencrypt" {{if eq .settings.ssl_acme_provider "letsencrypt"}}selected{{end}}>Let's Encrypt</option>
                            <option value="zerossl" {{if eq .settings.ssl_acme_provider "zerossl"}}selected{{end}}>ZeroSSL</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Save SSL Settings</button>
                </form>
            </div>
        </div>

        <!-- Weather Tab -->
        <div id="tab-weather" class="tab-content" role="tabpanel" aria-labelledby="tab-weather">
            <div class="card">
                <h2>üå§Ô∏è Weather Configuration</h2>
                <form id="form-weather" onsubmit="saveSettings(event, 'weather')" role="form">
                    <div class="form-group">
                        <label for="weather_refresh_interval">Refresh Interval (seconds)</label>
                        <input type="number" id="weather_refresh_interval" name="weather.refresh_interval"
                               value="{{.settings.weather_refresh_interval}}" min="300">
                        <small>How often to refresh weather data (default: 1800 = 30 minutes)</small>
                    </div>
                    <div class="form-group">
                        <label for="weather_default_units">Default Units</label>
                        <select id="weather_default_units" name="weather.default_units">
                            <option value="auto" {{if eq .settings.weather_default_units "auto"}}selected{{end}}>Auto (based on location)</option>
                            <option value="metric" {{if eq .settings.weather_default_units "metric"}}selected{{end}}>Metric (¬∞C, km/h)</option>
                            <option value="imperial" {{if eq .settings.weather_default_units "imperial"}}selected{{end}}>Imperial (¬∞F, mph)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="weather.cache_enabled" {{if .settings.weather_cache_enabled}}checked{{end}}
                                   aria-label="Enable caching" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Data Caching</span>
                        </label>
                        <small>Cache weather data for faster responses</small>
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="alerts.enabled" {{if .settings.alerts_enabled}}checked{{end}}
                                   aria-label="Enable alerts" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Severe Weather Alerts</span>
                        </label>
                        <small>Monitor and notify users of severe weather</small>
                    </div>
                    <div class="form-group">
                        <label for="alerts_check_interval">Alert Check Interval (seconds)</label>
                        <input type="number" id="alerts_check_interval" name="alerts.check_interval"
                               value="{{.settings.alerts_check_interval}}" min="60">
                        <small>How often to check for new alerts (default: 900 = 15 minutes)</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Weather Settings</button>
                </form>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div id="tab-notifications" class="tab-content" role="tabpanel" aria-labelledby="tab-notifications">
            <div class="card">
                <h2>üîî Notification System</h2>
                <form id="form-notifications" onsubmit="saveSettings(event, 'notifications')" role="form">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="notifications.enabled" {{if .settings.notifications_enabled}}checked{{end}}
                                   aria-label="Enable notifications" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Notification System</span>
                        </label>
                        <small>Enable notification queue and processing</small>
                    </div>
                    <div class="form-group">
                        <label for="notifications_queue_workers">Queue Workers</label>
                        <input type="number" id="notifications_queue_workers" name="notifications.queue_workers"
                               value="{{.settings.notifications_queue_workers}}" min="1" max="16">
                        <small>Number of concurrent notification processing threads</small>
                    </div>
                    <div class="form-group">
                        <label for="notifications_retry_max">Max Retries</label>
                        <input type="number" id="notifications_retry_max" name="notifications.retry_max"
                               value="{{.settings.notifications_retry_max}}" min="0" max="10">
                        <small>Maximum retry attempts for failed notifications</small>
                    </div>
                    <div class="form-group">
                        <label for="notifications_retry_backoff">Retry Strategy</label>
                        <select id="notifications_retry_backoff" name="notifications.retry_backoff">
                            <option value="linear" {{if eq .settings.notifications_retry_backoff "linear"}}selected{{end}}>Linear</option>
                            <option value="exponential" {{if eq .settings.notifications_retry_backoff "exponential"}}selected{{end}}>Exponential</option>
                        </select>
                        <small>Backoff strategy for retry delays</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                </form>
            </div>
        </div>

        <!-- Advanced Tab -->
        <div id="tab-advanced" class="tab-content" role="tabpanel" aria-labelledby="tab-advanced">
            <div class="card">
                <h2>üåç GeoIP Configuration</h2>
                <form id="form-geoip" onsubmit="saveSettings(event, 'geoip')" role="form">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="geoip.enabled" {{if .settings.geoip_enabled}}checked{{end}}
                                   aria-label="Enable GeoIP" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable GeoIP Location Detection</span>
                        </label>
                        <small>Automatically detect user locations from IP addresses</small>
                    </div>
                    <div class="form-group">
                        <label for="geoip_update_interval">Database Update Interval (seconds)</label>
                        <input type="number" id="geoip_update_interval" name="geoip.update_interval"
                               value="{{.settings.geoip_update_interval}}" min="86400">
                        <small>How often to update GeoIP databases (default: 604800 = 7 days)</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save GeoIP Settings</button>
                </form>
            </div>

            <div class="card">
                <h2>üåê CORS Configuration</h2>
                <form id="form-cors" onsubmit="saveSettings(event, 'cors')" role="form">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="cors.enabled" {{if .settings.cors_enabled}}checked{{end}}
                                   aria-label="Enable CORS" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable CORS</span>
                        </label>
                        <small>Allow cross-origin requests from browsers</small>
                    </div>
                    <div class="form-group">
                        <label for="cors_allowed_origins">Allowed Origins</label>
                        <input type="text" id="cors_allowed_origins" name="cors.allowed_origins"
                               value="{{.settings.cors_allowed_origins}}" placeholder="*">
                        <small>Comma-separated list of allowed origins (* for all)</small>
                    </div>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="cors.allow_credentials" {{if .settings.cors_allow_credentials}}checked{{end}}
                                   aria-label="Allow credentials" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Allow Credentials</span>
                        </label>
                        <small>Allow cookies and authentication headers in CORS requests</small>
                    </div>
                    <div class="form-group">
                        <label for="cors_max_age">Preflight Cache (seconds)</label>
                        <input type="number" id="cors_max_age" name="cors.max_age"
                               value="{{.settings.cors_max_age}}" min="0">
                        <small>How long browsers cache preflight responses (default: 43200 = 12 hours)</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save CORS Settings</button>
                </form>
            </div>

            <div class="card">
                <h2>‚è∞ Scheduler Configuration</h2>
                <form id="form-scheduler" onsubmit="saveSettings(event, 'scheduler')" role="form">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="scheduler.enabled" {{if .settings.scheduler_enabled}}checked{{end}}
                                   aria-label="Enable scheduler" role="switch">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Scheduled Tasks</span>
                        </label>
                        <small>Enable automated background task scheduling</small>
                    </div>
                    <div class="form-group">
                        <label for="scheduler_cleanup_sessions_interval">Session Cleanup (seconds)</label>
                        <input type="number" id="scheduler_cleanup_sessions_interval" name="scheduler.cleanup_sessions_interval"
                               value="{{.settings.scheduler_cleanup_sessions_interval}}" min="60">
                        <small>How often to clean up expired sessions (default: 3600 = 1 hour)</small>
                    </div>
                    <div class="form-group">
                        <label for="scheduler_cleanup_audit_logs_days">Audit Log Retention (days)</label>
                        <input type="number" id="scheduler_cleanup_audit_logs_days" name="scheduler.cleanup_audit_logs_days"
                               value="{{.settings.scheduler_cleanup_audit_logs_days}}" min="1">
                        <small>How many days to keep audit logs</small>
                    </div>
                    <div class="form-group">
                        <label for="scheduler_cleanup_notifications_days">Notification Retention (days)</label>
                        <input type="number" id="scheduler_cleanup_notifications_days" name="scheduler.cleanup_notifications_days"
                               value="{{.settings.scheduler_cleanup_notifications_days}}" min="1">
                        <small>How many days to keep old notifications</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Scheduler Settings</button>
                </form>
            </div>
        </div>

        <!-- Tor Tab -->
        <div id="tab-tor" class="tab-content" role="tabpanel" aria-labelledby="tab-tor">
            <div class="card">
                <h2>üßÖ Tor Hidden Service</h2>
                <form id="form-tor" onsubmit="saveSettings(event, 'tor')" role="form" aria-label="Tor hidden service settings">
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" name="tor.enabled" {{if .settings.tor_enabled}}checked{{end}}
                                   aria-label="Enable Tor hidden service"
                                   aria-describedby="tor-enabled-help"
                                   role="switch"
                                   aria-checked="{{if .settings.tor_enabled}}true{{else}}false{{end}}"
                                   title="Enable anonymous .onion address access via Tor network">
                            <span class="toggle-slider"></span>
                            <span class="toggle-text">Enable Tor Hidden Service</span>
                        </label>
                        <small id="tor-enabled-help">Make your service accessible via Tor network with a .onion address</small>
                    </div>

                    {{if .settings.tor_enabled}}
                    <div class="form-group">
                        <label for="tor_onion_address">Onion Address (Read-only)</label>
                        <input type="text" id="tor_onion_address" name="tor.onion_address"
                               value="{{.settings.tor_onion_address}}"
                               readonly
                               aria-label="Generated .onion address"
                               aria-describedby="tor-onion-help"
                               title="Your unique .onion address for anonymous Tor access">
                        <small id="tor-onion-help">This address is automatically generated and saved. Share it to allow Tor access.</small>
                    </div>

                    <div class="form-group">
                        <label for="tor_data_dir">Tor Data Directory (Read-only)</label>
                        <input type="text" id="tor_data_dir" name="tor.data_dir"
                               value="{{.settings.tor_data_dir}}"
                               readonly
                               aria-label="Tor data directory path"
                               aria-describedby="tor-datadir-help"
                               title="Location where Tor stores keys and configuration">
                        <small id="tor-datadir-help">Tor configuration and keys are stored here</small>
                    </div>
                    {{end}}

                    <div class="form-group">
                        <label for="tor_socks_port">SOCKS5 Proxy Port</label>
                        <input type="number" id="tor_socks_port" name="tor.socks_port"
                               value="{{.settings.tor_socks_port}}"
                               min="1024" max="65535"
                               aria-label="Tor SOCKS5 proxy port"
                               aria-describedby="tor-socks-help"
                               aria-required="true"
                               title="Port for Tor SOCKS5 proxy (usually 9050)">
                        <small id="tor-socks-help">Port for Tor SOCKS5 proxy connections (default: 9050)</small>
                    </div>

                    <div class="form-group">
                        <label for="tor_control_port">Control Port</label>
                        <input type="number" id="tor_control_port" name="tor.control_port"
                               value="{{.settings.tor_control_port}}"
                               min="1024" max="65535"
                               aria-label="Tor control port"
                               aria-describedby="tor-control-help"
                               aria-required="true"
                               title="Port for Tor control protocol (usually 9051)">
                        <small id="tor-control-help">Port for Tor control protocol (default: 9051)</small>
                    </div>

                    <button type="submit" class="btn btn-primary" aria-label="Save Tor settings">Save Tor Settings</button>
                </form>

                <div class="card-footer">
                    <p><strong>Note:</strong> Changing Tor settings requires a server restart to take effect. Your .onion address will remain the same unless you regenerate it.</p>
                    <p><strong>Security:</strong> Access via .onion address is fully encrypted and anonymous through the Tor network. No external Tor installation required.</p>
                </div>
            </div>
        </div>

        <!-- Historical Weather Tab -->
        <div id="tab-history" class="tab-content" role="tabpanel" aria-labelledby="tab-history">
            <div class="card">
                <h2>üìä Historical Weather Settings</h2>
                <p>Configure the historical weather data feature that allows users to view weather patterns for any day across multiple years.</p>

                <form id="form-history"
                      onsubmit="saveSettings(event, 'history')"
                      role="form"
                      aria-label="Historical weather settings">

                    <div class="form-group">
                        <label for="history_enabled">
                            <input type="checkbox"
                                   id="history_enabled"
                                   name="history.enabled"
                                   {{if .Settings.HistoryEnabled}}checked{{end}}
                                   role="switch"
                                   aria-checked="{{if .Settings.HistoryEnabled}}true{{else}}false{{end}}"
                                   aria-label="Enable historical weather feature"
                                   title="Allow users to access historical weather data">
                            Enable Historical Weather Feature
                        </label>
                        <small>Allow users to view weather data for any day across multiple years (1940-present)</small>
                    </div>

                    <div class="form-group">
                        <label for="history_default_years"
                               aria-label="Default number of years to display">
                            Default Years to Display
                            <span aria-hidden="true">*</span>
                        </label>
                        <input type="number"
                               id="history_default_years"
                               name="history.default_years"
                               value="{{.Settings.HistoryDefaultYears}}"
                               min="5"
                               max="50"
                               required
                               aria-required="true"
                               aria-describedby="history-default-years-help"
                               aria-valuemin="5"
                               aria-valuemax="50"
                               title="Default number of years to show in historical view">
                        <small id="history-default-years-help">
                            Default number of years to display when users first visit the historical weather page (5-50 years)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="history_min_years"
                               aria-label="Minimum allowed years">
                            Minimum Years Allowed
                            <span aria-hidden="true">*</span>
                        </label>
                        <input type="number"
                               id="history_min_years"
                               name="history.min_years"
                               value="{{.Settings.HistoryMinYears}}"
                               min="1"
                               max="50"
                               required
                               aria-required="true"
                               aria-describedby="history-min-years-help"
                               title="Minimum number of years users can request">
                        <small id="history-min-years-help">
                            Minimum number of years users can request in a single query (reduces server load)
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="history_max_years"
                               aria-label="Maximum allowed years">
                            Maximum Years Allowed
                            <span aria-hidden="true">*</span>
                        </label>
                        <input type="number"
                               id="history_max_years"
                               name="history.max_years"
                               value="{{.Settings.HistoryMaxYears}}"
                               min="5"
                               max="100"
                               required
                               aria-required="true"
                               aria-describedby="history-max-years-help"
                               title="Maximum number of years users can request">
                        <small id="history-max-years-help">
                            Maximum number of years users can request in a single query (prevents excessive API calls)
                        </small>
                    </div>

                    <button type="submit"
                            class="btn btn-primary"
                            aria-label="Save historical weather settings">
                        üíæ Save Historical Weather Settings
                    </button>
                </form>

                <div class="card-footer">
                    <p><strong>üìä Data Source:</strong> Historical weather data is provided by Open-Meteo's archive API, covering the period from 1940 to present.</p>
                    <p><strong>üîÑ Caching:</strong> Historical data is cached for 24 hours since it doesn't change, improving performance and reducing API calls.</p>
                    <p><strong>üìà Features:</strong> Users can view year-over-year comparisons, statistical analysis (warmest/coldest/wettest years), and comprehensive weather parameters.</p>
                    <p><strong>‚ôø Accessibility:</strong> Full WCAG 2.1 AA compliance with ARIA labels, semantic HTML, and keyboard navigation support.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="/static/js/app.js"></script>
    <script>
        // Tab switching
        function switchSettingsTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Save settings
        async function saveSettings(event, category) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const settings = {};

            // Convert form data to settings object
            for (let [key, value] of formData.entries()) {
                if (form.elements[key].type === 'checkbox') {
                    settings[key] = form.elements[key].checked;
                } else {
                    settings[key] = value;
                }
            }

            try {
                // Send multiple settings updates
                for (let [key, value] of Object.entries(settings)) {
                    const response = await fetch(`/api/v1/admin/settings/${key}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ value: value })
                    });

                    if (!response.ok) {
                        throw new Error(`Failed to update ${key}`);
                    }
                }

                Toast.success(`${category} settings saved successfully`);

                // Reload page after a delay to show new settings
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } catch (error) {
                Toast.error('Failed to save settings: ' + error.message);
                console.error('Error saving settings:', error);
            }
        }

        // Initialize notifications
        document.addEventListener('DOMContentLoaded', function() {
            Notifications.fetch();
            Notifications.startPolling(60000); // Poll every minute
        });
    </script>

{{template "footer" .}}
